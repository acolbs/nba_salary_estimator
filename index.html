<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>NBA Salary Tool</title>
<link rel="stylesheet" href="style.css">

<!-- CSV Parser -->
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
    /* Value color coding */
    .excellent-value { color: #00ff00; font-weight: bold; }
    .good-value { color: #90ee90; }
    .fair-value { color: #ffffff; }
    .overpaid { color: #ffb347; }
    .very-overpaid { color: #ff4444; font-weight: bold; }

    /* Tabs - centered and prominent */
    .tab {
        display: flex;
        justify-content: center;
        gap: 12px;
        border-bottom: 2px solid #444;
        padding: 12px 0;
        margin-bottom: 20px;
        background: linear-gradient(180deg, rgba(0,0,0,0.03), transparent);
    }
    .tab button {
        background: #1f2937;
        color: #fff;
        border: none;
        padding: 10px 18px;
        cursor: pointer;
        font-size: 15px;
        border-radius: 8px;
        box-shadow: 0 2px 6px rgba(0,0,0,0.12);
    }
    .tab button.active {
        background: #2196F3;
        color: #fff;
        font-weight: 700;
        transform: translateY(-2px);
        box-shadow: 0 6px 14px rgba(33,150,243,0.18);
    }

    .tabcontent { display: none; padding: 8px 16px; }

    /* Basic layout (kept minimal — use style.css for full layout) */
    .container { display: flex; gap: 24px; align-items: flex-start; }
    .left { flex: 1 1 60%; }
    .right { flex: 0 0 36%; background: rgba(0,0,0,0.03); padding: 12px; border-radius: 8px; }
    table { width: 100%; border-collapse: collapse; margin-top: 8px; }
    th, td { padding: 6px 8px; text-align: left; border-bottom: 1px solid rgba(255,255,255,0.04); }
    .filter-buttons { margin-top: 8px; display:flex; gap:8px; }
    #valueLegend { font-size: 14px; margin: 10px 0; }
    #gmTable th, #gmTable td { padding: 8px; }
</style>

<script src="script.js" defer></script>
</head>
<body>

<header>
    <h1>NBA Player Salary Estimator + Roster Builder</h1>
</header>

<div class="tab">
    <button class="tablink" onclick="openTab('rosterTab', this)">Roster Builder</button>
    <button class="tablink" onclick="openTab('graphTab', this)">Salary Graph</button>
    <button class="tablink" onclick="openTab('gmTab', this)">GM Rankings</button>
    <button class="tablink" onclick="openTab('teamPieTab', this)">Team Salary Distribution</button>
    <button class="tablink" onclick="openTab('formulaTab', this)">Formula</button>
    <button class="tablink" onclick="openTab('simTab', this)">Simulator (Work in Progress)</button>
</div>

<!-- Roster Builder Tab -->
<div id="rosterTab" class="tabcontent">
    <div class="container">
        <!-- LEFT PANEL: PLAYER LIST -->
        <div class="left">
            <h2>All Players</h2>
            <input type="text" id="searchPlayer" placeholder="Search players..." />

            <div id="filters">
                <div class="filter-group">
                    <label>Salary:</label>
                    <div class="salary-filter">
                        <select id="salaryOperator">
                            <option value=">=">&ge;</option>
                            <option value="<=">&le;</option>
                        </select>
                        <input type="number" id="salaryValue" placeholder="Enter salary" />
                    </div>
                </div>

                <div class="filter-group">
                    <label>Value:</label>
                    <select id="valueFilter">
                        <option value="all">All Players</option>
                        <option value="underpaid">Underpaid (Best Value)</option>
                        <option value="fair">Fair Value</option>
                        <option value="overpaid">Overpaid</option>
                    </select>
                </div>

                <div class="filter-group">
                    <label>Position:</label>
                    <div id="positionFilter">
                        <label><input type="checkbox" value="PG"> PG</label>
                        <label><input type="checkbox" value="SG"> SG</label>
                        <label><input type="checkbox" value="SF"> SF</label>
                        <label><input type="checkbox" value="PF"> PF</label>
                        <label><input type="checkbox" value="C"> C</label>
                    </div>
                </div>

                <div class="filter-buttons">
                    <button id="applyFiltersBtn">Apply Filters</button>
                    <button id="resetFiltersBtn">Reset Filters</button>
                </div>
            </div>

            <!-- moved legend here so it's below filters and above players -->
            <p id="valueLegend">
                <span class="excellent-value">■ Excellent Value (20%+ underpaid)</span> |
                <span class="good-value">■ Good Value (10-20% underpaid)</span> |
                <span class="fair-value">■ Fair Value (±10%)</span> |
                <span class="overpaid">■ Overpaid (10-20%)</span> |
                <span class="very-overpaid">■ Very Overpaid (20%+)</span>
            </p>

            <table id="playersTable">
                <thead>
                    <tr>
                        <th>Player</th>
                        <th>Team</th>
                        <th>Pos</th>
                        <th>Salary</th>
                        <th>ACE</th>
                        <th>Value</th>
                        <th>Add</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>

        <!-- RIGHT PANEL: ROSTER -->
        <div class="right">
            <h2>Your Roster (Max 10)</h2>
            <p><strong>Salary Cap:</strong> $150,000,000</p>
            <p><strong>Remaining:</strong> <span id="capRemaining">$150,000,000</span></p>
            <div id="rosterSummary">
                <p>Total Players: <span id="totalPlayers">0</span></p>
                <p><strong>Average Value:</strong> <span id="avgValue">0.0%</span></p>
                <ul>
                    <li>PG: <span id="pgCount">0</span></li>
                    <li>SG: <span id="sgCount">0</span></li>
                    <li>SF: <span id="sfCount">0</span></li>
                    <li>PF: <span id="pfCount">0</span></li>
                    <li>C: <span id="cCount">0</span></li>
                </ul>
            </div>

            <table id="rosterTable">
                <thead>
                    <tr>
                        <th>Player</th>
                        <th>Team</th>
                        <th>Pos</th>
                        <th>Salary</th>
                        <th>ACE</th>
                        <th>Value</th>
                        <th>Remove</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>
</div>

<!-- Salary Graph Tab -->
<div id="graphTab" class="tabcontent">
    <h2>Salary vs ACE Graph</h2>
    <p>Players are placed by salary (horizontal axis) and value (vertical axis): top-right are high salary, high value stars; top-left are low salary, high value bargains; bottom-right are high salary, low value overpaid; bottom-left are low salary, low value role players.</p>
    <div style="display: flex; justify-content: center; align-items: center; width: 100%;">
        <canvas id="salaryChart" style="max-width: 100%; height: 125px;"></canvas>
    </div>
</div>

</div>

<!-- Best GMs Tab -->
<div id="gmTab" class="tabcontent">
    <h2>Best GM Rankings (Team Contract Value Efficiency)</h2>
    <p style="font-size:13px; margin-top:6px;">Ranked by average Value% across all players listed for each team (lower is better — more underpaid).</p>
    <table id="gmTable">
    <thead>
        <tr>
            <th>Rank</th>
            <th>GM</th>
            <th>Team</th>
            <th>Players Counted</th>
            <th>Avg Value</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>
</div>

<!-- New Tab -->
<!-- Team Pie Charts Tab -->
<div id="teamPieTab" class="tabcontent">
    <h2>Team Salary Distribution</h2>
    <div id="teamPieCharts" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 24px;"></div>

</div>

<style>
.chart-wrapper {
    width: 500px;
    height: 500px;
    background-color: #1e1e1e;
    border-radius: 8px;
    padding: 10px;
    box-sizing: border-box;
    box-shadow: 0 2px 8px rgba(0,0,0,0.5);
}
.chart-wrapper h3 {
    font-size: 18px;
    text-align: center;
    margin: 0 0 12px 0;
}
.chart-canvas {
    width: 100% !important;
    height: 100% !important;
}
.team-pair {
    display: flex;
    flex-direction: column;
    gap: 12px;
    align-items: center;
}
</style>

<script>
function renderTeamPieCharts() {
    const container = document.getElementById('teamPieCharts');
    if (!container) return;
    container.innerHTML = ""; // Clear previous charts

    // Group players by team
    const teamMap = {};
    [...players, ...roster].forEach(p => {
        const team = (p.Tm || "Unknown").replace(/\s*\d+TM/gi, "").trim();
        if (!teamMap[team]) teamMap[team] = [];
        teamMap[team].push(p);
    });

    Object.entries(teamMap).forEach(([team, teamPlayers], i) => {
        const labels = teamPlayers.map(p => p.Player);
        const currentData = teamPlayers.map(p => p.SALARY);
        const estimatedData = teamPlayers.map(p => p.ACE);

        // Same colors for both charts
        const colors = labels.map(() => `rgba(${Math.floor(Math.random()*200)}, ${Math.floor(Math.random()*200)}, ${Math.floor(Math.random()*200)}, 0.7)`);

        // Wrapper for both charts vertically
        const pairWrapper = document.createElement('div');
        pairWrapper.className = 'team-pair';
        container.appendChild(pairWrapper);

        // Current chart
        const currWrapper = document.createElement('div');
        currWrapper.className = 'chart-wrapper';
        const currTitle = document.createElement('h3');
        currTitle.textContent = `${team} - Current`;
        currWrapper.appendChild(currTitle);
        const currCanvas = document.createElement('canvas');
        currCanvas.className = 'chart-canvas';
        currWrapper.appendChild(currCanvas);
        pairWrapper.appendChild(currWrapper);

        new Chart(currCanvas.getContext('2d'), {
            type: 'pie',
            data: { labels, datasets: [{ data: currentData, backgroundColor: colors }] },
            options: {
                responsive: true,
                plugins: { 
                    legend: { display: false },
                    tooltip: {
                        callbacks: {
                            label: ctx => `${ctx.label}: $${ctx.raw.toLocaleString()}`
                        }
                    }
                }
            }
        });

        // Estimated chart
        const estWrapper = document.createElement('div');
        estWrapper.className = 'chart-wrapper';
        const estTitle = document.createElement('h3');
        estTitle.textContent = `${team} - Estimated`;
        estWrapper.appendChild(estTitle);
        const estCanvas = document.createElement('canvas');
        estCanvas.className = 'chart-canvas';
        estWrapper.appendChild(estCanvas);
        pairWrapper.appendChild(estWrapper);

        new Chart(estCanvas.getContext('2d'), {
            type: 'pie',
            data: { labels, datasets: [{ data: estimatedData, backgroundColor: colors }] },
            options: {
                responsive: true,
                plugins: { 
                    legend: { display: false },
                    tooltip: {
                        callbacks: {
                            label: ctx => `${ctx.label}: $${ctx.raw.toLocaleString()}`
                        }
                    }
                }
            }
        });
    });
}

// Call whenever data changes
renderTeamPieCharts();
</script>

<!-- Formula Tab -->
<div id="formulaTab" class="tabcontent">
    <h2>How the Contract Valuation Formula Works</h2>
    <p>Our contract valuation engine combines modern performance analytics with real NBA salary distributions to generate accurate, data-driven contract predictions. Here’s a breakdown of the core components:</p>

    <h3>1. Player Impact Score (VALUE₁)</h3>
    <p>Every player starts with a unified performance rating called <strong>VALUE₁</strong> — a composite metric built from:</p>
    <ul>
        <li>Advanced impact statistics (EPM, VORP, on/off)</li>
        <li>Efficiency (TS%)</li>
        <li>Defensive metrics</li>
        <li>Minutes played and durability scaling</li>
        <li>And more advanced statistics</li>
    </ul>
    <p>This creates a single sortable rating that reflects a player’s true on-court value, not just box score numbers.</p>

    <h3>2. Percentile Ranking</h3>
    <p>Each VALUE₁ score is ranked against the entire league to determine the player’s percentile (0–100%). This rank is the backbone of the valuation model. Higher percentile = higher expected contract tier.</p>

    <h3>3. NBA-Shaped Salary Curve</h3>
    <p>Instead of guessing contract values or using a simple linear model, the site uses a real NBA salary distribution as the baseline. The curve mimics the actual 2025–26 NBA market:</p>
    <ul>
        <li>Top 2%: $55M–$60M</li>
        <li>Next 6%: $40M–$55M</li>
        <li>Next 10%: $30M–$40M</li>
        <li>Next 17%: $20M–$30M</li>
        <li>Next 30%: $10M–$20M</li>
        <li>Next 25%: $5M–$10M</li>
        <li>Bottom 10%: $2.5M–$5M</li>
    </ul>
    <p>This ensures the model produces contracts that look and behave like the real NBA economy.</p>

    <h3>4. Tiered Mapping Function</h3>
    <p>Players are assigned to salary tiers based on percentile, and each tier has a smooth interpolation formula so salaries scale gradually within that tier. Example: A 96th-percentile star doesn’t just jump to $50M — the formula curves him into that range in a mathematically smooth progression. This creates realistic AAVs that match modern contract trends.</p>

    <h3>5. Final Output (Displayed on Site)</h3>
    <p>Each player receives:</p>
    <ul>
        <li>AAV (Average Annual Value)</li>
        <li>Contract length</li>
        <li>Total contract amount</li>
        <li>Relative percentile ranking</li>
        <li>Salary comparison to real NBA players (if enabled)</li>
    </ul>
    <p>All calculated instantly, based on user-controlled settings and the underlying valuation engine.</p>
</div>

<!-- Simulator Tab -->
<div id="simTab" class="tabcontent">
    <h2>Simulate your custom roster to see how you compare to the rest of the league.</h2>
</div>


</body>
</html>
